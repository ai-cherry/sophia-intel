<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOPHIA Intel Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .chat-container {
            height: 400px;
            overflow-y: auto;
        }
        .status-card {
            transition: all 0.3s ease;
        }
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Dark Mode Styles */
        .dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .dark-mode .bg-white {
            background-color: #2d3748 !important;
        }
        .dark-mode .text-gray-800 {
            color: #e2e8f0 !important;
        }
        .dark-mode .text-gray-600 {
            color: #a0aec0 !important;
        }
        .dark-mode .bg-gray-50 {
            background-color: #4a5568 !important;
        }
        .dark-mode .border-gray-100 {
            border-color: #718096 !important;
        }
        .dark-mode .border-gray-300 {
            border-color: #718096 !important;
        }
        .dark-mode .bg-gradient-to-br {
            background: linear-gradient(to bottom right, #2d3748, #4a5568) !important;
        }
        .dark-mode .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1) !important;
        }
        .dark-mode .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1) !important;
        }
        .dark-mode .bg-red-50 {
            background-color: #742a2a !important;
        }
        .dark-mode .border-red-200 {
            border-color: #fc8181 !important;
        }
        .dark-mode .text-red-600 {
            color: #fc8181 !important;
        }
        .dark-mode input, .dark-mode textarea {
            background-color: #4a5568 !important;
            color: #e2e8f0 !important;
            border-color: #718096 !important;
        }
        .dark-mode input:focus, .dark-mode textarea:focus {
            border-color: #63b3ed !important;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1) !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [query, setQuery] = useState("");
            const [response, setResponse] = useState("");
            const [status, setStatus] = useState({});
            const [error, setError] = useState("");
            const [history, setHistory] = useState([]);
            const [loading, setLoading] = useState(false);
            const [activeTab, setActiveTab] = useState("chat");
            const [isDarkMode, setIsDarkMode] = useState(() => {
                return localStorage.getItem('sophia_theme') === 'dark';
            });

            const apiBase = "https://sophia-intel.fly.dev/api/v1";

            // Dark mode toggle function
            const toggleDarkMode = () => {
                setIsDarkMode(!isDarkMode);
            };

            // Apply dark mode class to body
            useEffect(() => {
                if (isDarkMode) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('sophia_theme', 'dark');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('sophia_theme', 'light');
                }
            }, [isDarkMode]);

            const fetchStatus = async () => {
                try {
                    const res = await axios.get(`${apiBase}/api/v1/health`);
                    setStatus(res.data);
                    setError("");
                } catch (err) {
                    setError("Failed to fetch status: " + err.message);
                }
            };

            const handleChat = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                try {
                    const res = await axios.post(`${apiBase}/api/v1/chat`, { 
                        message: query,
                        mode: "chat"
                    });
                    setResponse(res.data.response);
                    setHistory([...history, { 
                        query, 
                        response: res.data.response,
                        timestamp: new Date().toLocaleTimeString()
                    }]);
                    setQuery("");
                    setError("");
                } catch (err) {
                    setError("Chat request failed: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleCodeRequest = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                try {
                    const res = await axios.post(`${apiBase}/api/v1/code/modify`, {
                        query,
                        repo: "https://github.com/ai-cherry/sophia-intel"
                    });
                    setResponse(`PR created: ${res.data.pr_url}`);
                    setHistory([...history, { 
                        query, 
                        response: `Code modification completed. PR: ${res.data.pr_url}`,
                        timestamp: new Date().toLocaleTimeString()
                    }]);
                    setQuery("");
                    setError("");
                } catch (err) {
                    setError("Code request failed: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleSwarmRequest = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                try {
                    const res = await axios.post(`${apiBase}/api/v1/swarm/execute`, { task: query });
                    setResponse(`Swarm task completed: ${res.data.pr_url}`);
                    setHistory([...history, { 
                        query, 
                        response: `AI Swarm executed task. PR: ${res.data.pr_url}`,
                        timestamp: new Date().toLocaleTimeString()
                    }]);
                    setQuery("");
                    setError("");
                } catch (err) {
                    setError("Swarm request failed: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchStatus();
                const interval = setInterval(fetchStatus, 30000);
                return () => clearInterval(interval);
            }, []);

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleChat();
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div className="container mx-auto px-4 py-8">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">SOPHIA Intel</h1>
                            <p className="text-gray-600">AI-Powered Autonomous Intelligence Platform</p>
                            <button
                                className="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center mx-auto"
                                onClick={toggleDarkMode}
                            >
                                {isDarkMode ? 'ðŸŒž' : 'ðŸŒ™'} Toggle {isDarkMode ? 'Light' : 'Dark'} Mode
                            </button>
                        </header>

                        {/* Tab Navigation */}
                        <div className="flex justify-center mb-6">
                            <div className="bg-white rounded-lg p-1 shadow-md">
                                <button
                                    className={`px-6 py-2 rounded-md transition-all ${
                                        activeTab === "chat" 
                                            ? "bg-blue-500 text-white shadow-md" 
                                            : "text-gray-600 hover:bg-gray-100"
                                    }`}
                                    onClick={() => setActiveTab("chat")}
                                >
                                    Chat Interface
                                </button>
                                <button
                                    className={`px-6 py-2 rounded-md transition-all ${
                                        activeTab === "dashboard" 
                                            ? "bg-blue-500 text-white shadow-md" 
                                            : "text-gray-600 hover:bg-gray-100"
                                    }`}
                                    onClick={() => setActiveTab("dashboard")}
                                >
                                    System Dashboard
                                </button>
                            </div>
                        </div>

                        {activeTab === "chat" && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Chat Interface */}
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h2 className="text-2xl font-semibold mb-4 text-gray-800">Chat with SOPHIA</h2>
                                    
                                    <div className="mb-4">
                                        <textarea
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                            rows="4"
                                            value={query}
                                            onChange={(e) => setQuery(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            placeholder="Ask SOPHIA to code, research, integrate services, or manage infrastructure..."
                                            disabled={loading}
                                        />
                                    </div>
                                    
                                    <div className="flex gap-2 mb-4">
                                        <button
                                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
                                            onClick={handleChat}
                                            disabled={loading || !query.trim()}
                                        >
                                            {loading ? "Processing..." : "Chat"}
                                        </button>
                                        <button
                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
                                            onClick={handleCodeRequest}
                                            disabled={loading || !query.trim()}
                                        >
                                            Code
                                        </button>
                                        <button
                                            className="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
                                            onClick={handleSwarmRequest}
                                            disabled={loading || !query.trim()}
                                        >
                                            AI Swarm
                                        </button>
                                    </div>
                                    
                                    {response && (
                                        <div className="mb-4 p-3 bg-gray-50 rounded-lg border">
                                            <h4 className="font-semibold text-gray-700 mb-2">Latest Response:</h4>
                                            <p className="text-gray-600">{response}</p>
                                        </div>
                                    )}
                                    
                                    {error && (
                                        <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                            <p className="text-red-600">{error}</p>
                                        </div>
                                    )}
                                </div>

                                {/* Chat History */}
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">Conversation History</h3>
                                    <div className="chat-container space-y-3">
                                        {history.length === 0 ? (
                                            <p className="text-gray-500 text-center py-8">No conversations yet. Start chatting with SOPHIA!</p>
                                        ) : (
                                            history.slice().reverse().map((item, index) => (
                                                <div key={index} className="border-b border-gray-100 pb-3">
                                                    <div className="mb-2">
                                                        <span className="text-xs text-gray-500">{item.timestamp}</span>
                                                        <p className="font-medium text-gray-700">Q: {item.query}</p>
                                                    </div>
                                                    <p className="text-gray-600 text-sm">A: {item.response}</p>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === "dashboard" && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {/* System Health */}
                                <div className="status-card bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">System Health</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Status:</span>
                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                status.health === "OK" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"
                                            }`}>
                                                {status.health || "Loading..."}
                                            </span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Redis:</span>
                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                status.redis_status === "OK" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"
                                            }`}>
                                                {status.redis_status || "Loading..."}
                                            </span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Qdrant:</span>
                                            <span className="text-sm text-gray-700">{status.qdrant_status || "Loading..."}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* AI Models */}
                                <div className="status-card bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">AI Models</h3>
                                    <div className="space-y-2">
                                        {status.models ? status.models.map((model, index) => (
                                            <div key={index} className="flex items-center space-x-2">
                                                <div className="w-2 h-2 bg-green-400 rounded-full"></div>
                                                <span className="text-gray-700">{model}</span>
                                            </div>
                                        )) : (
                                            <p className="text-gray-500">Loading models...</p>
                                        )}
                                    </div>
                                </div>

                                    {/* Development Activity */}
                                <div className="status-card bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">Development</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Open PRs:</span>
                                            <span className="text-lg font-semibold text-blue-600">{status.github_prs || 0}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">DB Tables:</span>
                                            <span className="text-lg font-semibold text-green-600">{status.db_tables || 0}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">API Latency:</span>
                                            <span className="text-sm text-gray-700">{status.api_latency || "N/A"} ms</span>
                                        </div>
                                    </div>
                                </div>

                                {/* To-Do List with Persistence and Priority */}
                                <div className="status-card bg-white rounded-lg shadow-lg p-6 md:col-span-2 lg:col-span-3">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">Task Manager</h3>
                                    <div className="flex gap-2 mb-4">
                                        <input
                                            id="task-input"
                                            type="text"
                                            className="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Add a new task..."
                                        />
                                        <select
                                            id="task-priority"
                                            className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                            <option value="low">Low Priority</option>
                                            <option value="medium" selected>Medium Priority</option>
                                            <option value="high">High Priority</option>
                                        </select>
                                        <button
                                            id="add-task"
                                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"
                                        >
                                            Add Task
                                        </button>
                                    </div>
                                    <ul id="task-list" className="space-y-2">
                                        {/* Tasks will be dynamically added here */}
                                    </ul>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));

        // Task persistence functionality using localStorage
        function saveTasks(tasks) {
            localStorage.setItem('sophia_tasks', JSON.stringify(tasks));
        }

        function loadTasks() {
            return JSON.parse(localStorage.getItem('sophia_tasks') || '[]');
        }

        function addTaskToDOM(task, completed = false, priority = 'medium') {
            const taskList = document.getElementById('task-list');
            const li = document.createElement('li');
            
            // Priority color classes
            const priorityColors = {
                'high': 'border-l-4 border-red-500 bg-red-50',
                'medium': 'border-l-4 border-yellow-500 bg-yellow-50', 
                'low': 'border-l-4 border-green-500 bg-green-50'
            };
            
            const priorityBadges = {
                'high': '<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">High</span>',
                'medium': '<span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full">Medium</span>',
                'low': '<span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Low</span>'
            };
            
            li.className = `flex items-center gap-2 p-2 rounded border priority-${priority} ${priorityColors[priority]}`;
            li.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${completed ? 'checked' : ''}>
                <span class="task-text ${completed ? 'line-through text-gray-500' : ''} flex-1">${task}</span>
                <span class="task-priority">${priorityBadges[priority]}</span>
                <button class="delete-task ml-auto text-red-500 hover:text-red-700">Ã—</button>
            `;
            
            // Add event listeners
            const checkbox = li.querySelector('.task-checkbox');
            const deleteBtn = li.querySelector('.delete-task');
            const taskText = li.querySelector('.task-text');
            
            checkbox.addEventListener('change', () => {
                const tasks = loadTasks();
                const taskIndex = tasks.findIndex(t => t.text === task && t.priority === priority);
                if (taskIndex !== -1) {
                    tasks[taskIndex].completed = checkbox.checked;
                    saveTasks(tasks);
                    taskText.className = checkbox.checked ? 'task-text line-through text-gray-500 flex-1' : 'task-text flex-1';
                }
            });
            
            deleteBtn.addEventListener('click', () => {
                const tasks = loadTasks().filter(t => !(t.text === task && t.priority === priority));
                saveTasks(tasks);
                li.remove();
            });
            
            taskList.appendChild(li);
        }

        // Initialize task persistence on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Load existing tasks
            const tasks = loadTasks();
            tasks.forEach(task => addTaskToDOM(task.text, task.completed, task.priority || 'medium'));
            
            // Add task functionality
            const addTaskBtn = document.getElementById('add-task');
            const taskInput = document.getElementById('task-input');
            const taskPriority = document.getElementById('task-priority');
            
            function addTask() {
                const taskText = taskInput.value.trim();
                const priority = taskPriority.value;
                if (taskText) {
                    const tasks = loadTasks();
                    const newTask = { text: taskText, completed: false, priority: priority };
                    tasks.push(newTask);
                    saveTasks(tasks);
                    addTaskToDOM(taskText, false, priority);
                    taskInput.value = '';
                    taskPriority.value = 'medium'; // Reset to default
                }
            }
            
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            });
        });
    </script>
</body>
</html>              onClick={fetchStatus}
                                        >
                                            Refresh Status
                                        </button>
                                        <button
                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition-colors"
                                            onClick={() => {
                                                setActiveTab("chat");
                                                setQuery("Create a Python API for task management");
                                            }}
                                        >
                                            Quick Code
                                        </button>
                                        <button
                                            className="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition-colors"
                                            onClick={() => {
                                                setActiveTab("chat");
                                                setQuery("Research latest AI developments");
                                            }}
                                        >
                                            Research
                                        </button>
                                        <button
                                            className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg transition-colors"
                                            onClick={() => {
                                                setActiveTab("chat");
                                                setQuery("Deploy infrastructure updates");
                                            }}
                                        >
                                            Deploy
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Footer */}
                        <footer className="text-center mt-12 text-gray-500">
                            <p>SOPHIA Intel - Autonomous AI Platform | Last updated: {status.timestamp || "Loading..."}</p>
                        </footer>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>

