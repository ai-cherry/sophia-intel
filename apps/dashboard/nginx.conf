# Minimal, bulletproof Nginx for Fly (port 8080)
worker_processes 1;

events { worker_connections 1024; }

http {
  # Basic MIME types
  include       mime.types;
  default_type  application/octet-stream;
  sendfile      on;
  keepalive_timeout  65;

  server {
    listen 8080;
    server_name _;

    # Healthcheck: zero-dependency, instant 200
    location = /healthz {
      access_log off;
      default_type application/json;
      return 200 '{"status":"ok","service":"sophia-dashboard-live","version":"4.2.0"}';
    }

    # Build fingerprint (optional, but helpful)
    location = /__build {
      access_log off;
      default_type text/plain;
      return 200 "BUILD_ID=20250821T220000Z\n";
    }

    # Serve SPA assets
    root /usr/share/nginx/html;
    index index.html;

    # Assets MUST 200/404 without SPA fallback
    location ^~ /assets/ {
      access_log off;
      try_files $uri =404;
    }

    # SPA fallback
    location / {
      try_files $uri /index.html;
    }
  }
}

